<div class="min-h-screen bg-background p-6">
    <!-- Header -->
    <div class="mb-6">
        <button (click)="goBack()" class="text-primary hover:text-primary-hover mb-4 flex items-center gap-2">
            â† Volver a Funciones
        </button>

        <h1 class="text-2xl font-bold text-slate-900">EstadÃ­sticas de FunciÃ³n</h1>
        <p class="text-sm text-slate-600" *ngIf="function$ | async as func">
            {{ func.dateTime?.toDate ? (func.dateTime.toDate() | date:'EEEE d MMMM, y - HH:mm':'':'es-AR') :
            (func.dateTime | date:'EEEE d MMMM, y - HH:mm':'':'es-AR') }} hs
        </p>
    </div>

    <!-- Statistics Cards -->
    <div *ngIf="stats$ | async as stats" class="space-y-6">

        <!-- Main Metrics Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">

            <!-- Total Bookings -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-slate-200">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-slate-600">Total Reservas</span>
                    <span class="text-2xl">ğŸ“‹</span>
                </div>
                <div class="text-3xl font-bold text-slate-900">{{ stats.totalBookings }}</div>
            </div>

            <!-- Total Attendees -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-slate-200">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-slate-600">Total Asistentes</span>
                    <span class="text-2xl">ğŸ‘¥</span>
                </div>
                <div class="text-3xl font-bold text-slate-900">{{ stats.totalAttendees }}</div>
            </div>

            <!-- Capacity Used -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-slate-200">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-slate-600">Capacidad Utilizada</span>
                    <span class="text-2xl">ğŸ“Š</span>
                </div>
                <div class="text-3xl font-bold" [ngClass]="{
            'text-green-600': stats.capacityUsed >= 80,
            'text-amber-600': stats.capacityUsed >= 50 && stats.capacityUsed < 80,
            'text-slate-900': stats.capacityUsed < 50
          }">
                    {{ stats.capacityUsed | number:'1.0-1' }}%
                </div>
            </div>

            <!-- Total Revenue -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-slate-200">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-slate-600">Ingresos Totales</span>
                    <span class="text-2xl">ğŸ’°</span>
                </div>
                <div class="text-3xl font-bold text-green-600">${{ stats.totalRevenue | number:'1.0-0' }}</div>
            </div>

        </div>

        <!-- Success Message with Cafecito -->
        <div *ngIf="(function$ | async) as func">
            <div *ngIf="isSuccessfulEvent(stats, func)"
                class="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6 mb-6">
                <div class="flex items-start gap-4">
                    <div class="text-4xl">ğŸ‰</div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-green-900 mb-2">
                            Â¡Excelente resultado!
                        </h3>
                        <p class="text-sm text-green-800 mb-3">
                            Tu evento tuvo un <strong>{{ stats.capacityUsed | number:'1.0-1' }}% de ocupaciÃ³n</strong>
                            <span *ngIf="stats.totalBookings > 0">
                                y <strong>{{ (stats.confirmedBookings / stats.totalBookings * 100) | number:'1.0-1' }}%
                                    de confirmaciÃ³n</strong>
                            </span>.
                            Â¡Felicitaciones! ğŸŠ
                        </p>
                        <div class="bg-white/50 rounded-lg p-4 mb-4">
                            <p class="text-sm text-green-700 mb-3">
                                Si EnPuerta te ayudÃ³ a lograr este resultado, considerÃ¡ apoyar el proyecto:
                            </p>
                            <div class="flex items-center gap-3">
                                <a href="https://cafecito.app/enpuerta" target="_blank" rel="noopener noreferrer"
                                    class="inline-flex items-center gap-2 px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg text-sm font-medium transition-colors shadow-sm">
                                    <span>â˜•</span>
                                    <span>Invitar un cafecito</span>
                                </a>
                                <span class="text-xs text-green-600">Monto sugerido: $5.000</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secondary Metrics -->
        <div class="bg-white rounded-xl shadow-sm p-6 border border-slate-200">
            <h2 class="text-lg font-semibold text-slate-900 mb-4">Detalles de Reservas</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                <!-- Average per Booking -->
                <div class="flex items-center justify-between p-4 bg-slate-50 rounded-lg">
                    <span class="text-sm font-medium text-slate-700">Promedio por Reserva</span>
                    <span class="text-xl font-bold text-slate-900">{{ stats.averagePerBooking | number:'1.1-1' }}
                        entradas</span>
                </div>

                <!-- Booking Status Breakdown -->
                <div class="p-4 bg-slate-50 rounded-lg">
                    <div class="text-sm font-medium text-slate-700 mb-3">Estado de Reservas</div>
                    <div class="space-y-2">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-slate-600">âœ… Confirmadas</span>
                            <span class="font-semibold text-green-600">{{ stats.confirmedBookings }}</span>
                        </div>
                        <div class="flex items-center justify-between" *ngIf="stats.pendingBookings > 0">
                            <span class="text-sm text-slate-600">â³ Pendientes</span>
                            <span class="font-semibold text-amber-600">{{ stats.pendingBookings }}</span>
                        </div>
                        <div class="flex items-center justify-between" *ngIf="stats.cancelledBookings > 0">
                            <span class="text-sm text-slate-600">âŒ Canceladas</span>
                            <span class="font-semibold text-red-600">{{ stats.cancelledBookings }}</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="stats.totalBookings === 0" class="bg-amber-50 border border-amber-200 rounded-xl p-6 text-center">
            <p class="text-amber-800 font-medium">ğŸ“Š No hay reservas para esta funciÃ³n</p>
            <p class="text-sm text-amber-600 mt-1">Las estadÃ­sticas se mostrarÃ¡n cuando haya reservas registradas.</p>
        </div>

    </div>
</div>