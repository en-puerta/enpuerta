<div class="min-h-screen bg-background p-6">
    <!-- Header -->
    <h1 class="text-2xl font-bold mb-1">Funciones</h1>
    <p class="text-sm text-slate-600 mb-6">{{ eventName }}</p>

    <!-- New Function Button -->
    <div class="flex justify-end mb-6" *ngIf="(event$ | async) as event">
        <button (click)="goToNewFunction()" *ngIf="event.status !== 'finished'"
            class="bg-primary hover:bg-primary-hover text-white px-4 py-2 rounded-full">
            + Nueva funci√≥n
        </button>
        <div *ngIf="event.status === 'finished'" class="text-sm text-slate-500 italic">
            Este evento est√° finalizado. No se pueden agregar nuevas funciones.
        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="(functions$ | async)?.length === 0"
        class="bg-white p-10 rounded-xl shadow-sm text-center text-slate-500">
        No hay funciones. <br> Comenz√° creando la primera funci√≥n.
        <div class="mt-4">
            <button (click)="goToNewFunction()"
                class="bg-primary hover:bg-primary-hover text-white px-6 py-2.5 rounded-lg font-medium shadow-sm transition-colors">
                + Crear primera funci√≥n
            </button>
        </div>
    </div>

    <!-- Mobile Card View -->
    <div *ngIf="(functions$ | async)?.length" class="md:hidden space-y-4">
        <div *ngFor="let func of functions$ | async" class="bg-white rounded-xl shadow-sm p-4 border border-slate-200">
            <!-- Date/Time -->
            <div class="mb-3">
                <div class="font-semibold text-slate-900 text-lg">
                    {{ func.dateTime?.toDate ? (func.dateTime.toDate() | date:'d MMM, y':'':'es-AR') : (func.dateTime |
                    date:'d MMM, y':'':'es-AR') }}
                </div>
                <div class="text-slate-600">
                    {{ func.dateTime?.toDate ? (func.dateTime.toDate() | date:'HH:mm') : (func.dateTime | date:'HH:mm')
                    }} hs
                </div>
            </div>

            <!-- Capacity, Price & Status -->
            <div class="flex items-center gap-4 mb-3 flex-wrap">
                <div class="text-sm">
                    <span class="text-slate-600">Capacidad:</span>
                    <span class="font-semibold text-slate-900 ml-1">{{ func.capacity }}</span>
                </div>
                <div class="text-sm">
                    <span class="text-slate-600">Precio:</span>
                    <span class="font-semibold text-slate-900 ml-1">${{ func.price }}</span>
                </div>
                <app-status-badge [status]="func.status"></app-status-badge>
            </div>

            <!-- Actions -->
            <div class="flex flex-col gap-2">
                <!-- Show these buttons only if NOT finished -->
                <button (click)="editFunction(func.functionId)" *ngIf="func.status !== 'finished'"
                    class="w-full px-4 py-2.5 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg text-sm font-medium transition-colors">
                    ‚úèÔ∏è Editar
                </button>
                <button (click)="viewBookings(func.functionId)" *ngIf="func.status !== 'finished'"
                    class="w-full px-4 py-2.5 bg-amber-50 hover:bg-amber-100 text-amber-700 rounded-lg text-sm font-medium transition-colors">
                    üìã Reservas
                </button>
                <button (click)="viewLive(func.functionId)" *ngIf="func.status !== 'finished'"
                    class="w-full px-4 py-2.5 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg text-sm font-medium transition-colors">
                    üì° En Vivo
                </button>
                <button (click)="finalizeFunction(func)" *ngIf="func.status === 'open'"
                    class="w-full px-4 py-2.5 bg-green-50 hover:bg-green-100 text-green-600 rounded-lg text-sm font-medium transition-colors">
                    ‚úÖ Finalizar
                </button>
                <button (click)="cancelFunction(func)" *ngIf="func.status === 'open'"
                    class="w-full px-4 py-2.5 bg-red-50 hover:bg-red-100 text-red-600 rounded-lg text-sm font-medium transition-colors">
                    ‚ùå Cancelar
                </button>

                <!-- Show statistics button only if finished -->
                <button (click)="viewStatistics(func.functionId)" *ngIf="func.status === 'finished'"
                    class="w-full px-4 py-2.5 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg text-sm font-medium transition-colors">
                    üìä Estad√≠sticas
                </button>
            </div>
        </div>
    </div>

    <!-- Desktop Table View -->
    <div *ngIf="(functions$ | async)?.length" class="hidden md:block bg-white rounded-xl shadow-sm overflow-hidden">
        <table class="min-w-full">
            <thead class="bg-slate-100 text-slate-600 text-sm">
                <tr>
                    <th class="px-4 py-3 text-left font-semibold">Fecha/Hora</th>
                    <th class="px-4 py-3 text-left font-semibold">Capacidad</th>
                    <th class="px-4 py-3 text-left font-semibold">Precio</th>
                    <th class="px-4 py-3 text-left font-semibold">Estado</th>
                    <th class="px-4 py-3 text-right font-semibold">Acciones</th>
                </tr>
            </thead>
            <tbody class="divide-y text-sm">
                <tr *ngFor="let func of functions$ | async" class="hover:bg-slate-50 transition-colors">
                    <td class="px-4 py-3">
                        <div class="font-medium text-slate-900">
                            {{ func.dateTime?.toDate ? (func.dateTime.toDate() | date:'d MMM, y':'':'es-AR') :
                            (func.dateTime | date:'d MMM, y':'':'es-AR') }}
                        </div>
                        <div class="text-slate-600">
                            {{ func.dateTime?.toDate ? (func.dateTime.toDate() | date:'HH:mm') : (func.dateTime |
                            date:'HH:mm') }} hs
                        </div>
                    </td>
                    <td class="px-4 py-3 text-slate-600">{{ func.capacity }}</td>
                    <td class="px-4 py-3 font-medium text-slate-900">${{ func.price }}</td>
                    <td class="px-4 py-3">
                        <app-status-badge [status]="func.status"></app-status-badge>
                    </td>
                    <td class="px-4 py-3 text-right">
                        <div class="flex items-center justify-end gap-2">
                            <!-- Show these buttons only if NOT finished -->
                            <button (click)="editFunction(func.functionId)" *ngIf="func.status !== 'finished'"
                                class="px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-md text-xs font-medium transition-colors">
                                ‚úèÔ∏è Editar
                            </button>
                            <button (click)="viewBookings(func.functionId)" *ngIf="func.status !== 'finished'"
                                class="px-3 py-1.5 bg-amber-50 hover:bg-amber-100 text-amber-700 rounded-md text-xs font-medium transition-colors">
                                üìã Reservas
                            </button>
                            <button (click)="viewLive(func.functionId)" *ngIf="func.status !== 'finished'"
                                class="px-3 py-1.5 bg-primary/10 hover:bg-primary/20 text-primary rounded-md text-xs font-medium transition-colors">
                                üì° En Vivo
                            </button>
                            <button (click)="finalizeFunction(func)" *ngIf="func.status === 'open'"
                                class="px-3 py-1.5 bg-green-50 hover:bg-green-100 text-green-600 rounded-md text-xs font-medium transition-colors">
                                ‚úÖ Finalizar
                            </button>
                            <button (click)="cancelFunction(func)" *ngIf="func.status === 'open'"
                                class="px-3 py-1.5 bg-red-50 hover:bg-red-100 text-red-600 rounded-md text-xs font-medium transition-colors">
                                ‚ùå Cancelar
                            </button>

                            <!-- Show statistics button only if finished -->
                            <button (click)="viewStatistics(func.functionId)" *ngIf="func.status === 'finished'"
                                class="px-3 py-1.5 bg-green-50 hover:bg-green-100 text-green-700 rounded-md text-xs font-medium transition-colors">
                                üìä Estad√≠sticas
                            </button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>