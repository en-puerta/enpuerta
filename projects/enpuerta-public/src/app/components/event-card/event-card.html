<div class="bg-white rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden border border-slate-200 flex flex-col h-full group"
    [ngClass]="{'opacity-75': isSoldOut}">
    <!-- Image -->
    <div
        class="relative h-48 sm:h-56 overflow-hidden bg-white flex items-center justify-center border-b border-slate-100">
        <img [src]="event.coverImageUrl || 'assets/placeholder-event.jpg'" [alt]="event.nameInternal"
            class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
            onerror="this.style.display='none'; this.parentElement.querySelector('.fallback-logo').style.display='flex';">
        <div class="fallback-logo hidden w-full h-full flex-col items-center justify-center gap-2 p-8"
            style="display:none;">
            <img src="assets/images/logo-icon.jpg" alt="EnPuerta" class="w-full h-full object-cover opacity-15">
        </div>

        <!-- Chip -->
        <div class="absolute top-3 left-3">
            <span
                class="bg-primary/90 backdrop-blur-sm text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider shadow-sm">
                {{ event.eventType }}
            </span>
        </div>

        <!-- Sold Out Badge -->
        <div *ngIf="isSoldOut" class="absolute top-3 right-3">
            <span
                class="bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider shadow-lg">
                Agotado
            </span>
        </div>
    </div>

    <!-- Content -->
    <div class="p-5 flex-1 flex flex-col bg-gradient-to-b from-white to-background/30">
        <h3 class="text-lg font-bold text-slate-900 mb-2 group-hover:text-primary transition-colors line-clamp-1"
            [title]="event.aliasPublic">
            {{ event.aliasPublic }}
        </h3>

        <p class="text-slate-500 text-sm mb-4 line-clamp-2 flex-1">
            {{ event.descriptionShort }}
        </p>

        <!-- Next Function (loads progressively) -->
        <div *ngIf="nextFunction" class="mb-4 p-3 bg-background rounded-lg border border-primary/20">
            <div class="flex items-center justify-between mb-2">
                <p class="text-xs text-slate-500 font-medium uppercase">PrÃ³xima funciÃ³n</p>
                <span *ngIf="functionsCount > 1"
                    class="text-xs px-2 py-0.5 bg-primary/10 text-primary rounded-full font-medium">
                    +{{ functionsCount - 1 }} mÃ¡s
                </span>
            </div>

            <!-- Date -->
            <div class="flex items-center gap-2 mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-4 h-4 text-slate-600">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" />
                </svg>
                <span class="text-sm font-semibold text-slate-700">
                    {{ nextFunction.dateTime | date: 'EEE d MMM, HH:mm' }}
                </span>
            </div>

            <!-- Price -->
            <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-4 h-4 text-primary">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-5.25h5.25M7.5 15h3M3.375 5.25c-.621 0-1.125.504-1.125 1.125v3.026a2.999 2.999 0 0 1 0 5.198v3.026c0 .621.504 1.125 1.125 1.125h17.25c.621 0 1.125-.504 1.125-1.125v-3.026a2.999 2.999 0 0 1 0-5.198V6.375c0-.621-.504-1.125-1.125-1.125H3.375Z" />
                </svg>
                <span class="text-sm font-bold text-primary">
                    <ng-container [ngSwitch]="event.pricingType">
                        <span *ngSwitchCase="'free'">Gratis ðŸŽ‰</span>
                        <span *ngSwitchCase="'pay-what-you-want'">
                            A la gorra
                            <span *ngIf="event.suggestedPrice" class="text-xs font-normal"> (sugerido ${{
                                event.suggestedPrice }})</span>
                        </span>
                        <span *ngSwitchCase="'fixed'">${{ nextFunction.price }}</span>
                        <span *ngSwitchDefault>${{ nextFunction.price }}</span>
                    </ng-container>
                </span>
            </div>
        </div>

        <!-- Action -->
        <a [routerLink]="['/e', event.aliasPublic]" *ngIf="!isSoldOut"
            class="block w-full text-center bg-primary hover:bg-primary-hover text-white font-semibold py-2.5 rounded-lg transition-colors shadow-sm">
            Ver detalle
        </a>

        <div *ngIf="isSoldOut"
            class="block w-full text-center bg-slate-400 text-white font-semibold py-2.5 rounded-lg cursor-not-allowed">
            Agotado
        </div>
    </div>
</div>